# ü§ñ Ralph Wiggum Workflow for Gemini CLI

> **A comprehensive guide to autonomous AI development using the Ralph Wiggum technique with Gemini CLI.**

[![Gemini CLI](https://img.shields.io/badge/Gemini-CLI-blue?style=flat-square)](https://geminicli.com/) [![Autonomous](https://img.shields.io/badge/Mode-Autonomous-success?style=flat-square)](https://ghuntley.com/ralph/) [![License](https://img.shields.io/badge/License-MIT-blue?style=flat-square)](#)

---

## üìë Table of Contents

- [What is Ralph Wiggum?](#-what-is-ralph-wiggum)
- [How to Set Up](#-how-to-set-up)
- [The Workflow](#-the-workflow)
- [Phase 1: Clarify](#-phase-1-clarify)
- [Phase 2: Plan](#-phase-2-plan)
- [Phase 3: Execute](#-phase-3-execute)
- [Templates](#-templates)
- [Quick Start](#-quick-start)
- [Differences from ralph-kiro](#-differences-from-ralph-kiro)
- [Troubleshooting](#-troubleshooting)
- [Philosophy Recap](#-philosophy-recap)
- [Sources](#-sources)

---

## üß† What is Ralph Wiggum?

Ralph Wiggum is an autonomous development technique created by **Geoffrey Huntley**. At its core, it's simple:

```bash
while :; do cat PROMPT.md | gemini -p "$(cat -)" ; done
```

A bash loop that repeatedly feeds the same prompt to an AI agent until the task is complete.

### Philosophy

> _"The technique is **deterministically bad in an undeterministic world**."_

- When Ralph fails, you don't blame the tools ‚Äî **you tune the prompts**
- Failures are predictable and informative
- Success requires faith in eventual consistency
- Each failure teaches you what "signs" (guardrails) to add

### The Playground Metaphor

From Huntley:

> _"Ralph is very good at making playgrounds, but he comes home bruised because he fell off the slide, so one then tunes Ralph by adding a sign next to the slide saying 'SLIDE DOWN, DON'T JUMP, LOOK AROUND,' and Ralph is more likely to look and see the sign."_

Eventually, the prompt has enough guardrails that Ralph works reliably.

---

## üîß How to Set Up

### Prerequisites

| Requirement | Description |
|------------|-------------|
| **Gemini CLI** | Already installed and authenticated |
| **Git** | For state tracking and memory |

### Step 1: Install Gemini CLI

If you haven't already installed Gemini CLI:

```bash
# Using npx (no installation required)
npx @google/gemini-cli

# Install globally with npm
npm install -g @google/gemini-cli

# Install globally with Homebrew (macOS/Linux)
brew install gemini-cli

# Verify installation
gemini --version
```

### Step 2: Authenticate Gemini CLI

Choose the authentication method that best fits your needs:

#### Option 1: Login with Google (Recommended)

**Best for:** Individual developers and anyone with a Gemini Code Assist License.

**Benefits:**
- **Free tier**: 60 requests/min and 1,000 requests/day
- **Gemini 2.5 Pro** with 1M token context window
- **No API key management** - just sign in with your Google account

```bash
# Start Gemini CLI, then choose "Login with Google"
gemini
```

If you're using a paid Code Assist License from your organization:

```bash
# Set your Google Cloud Project
export GOOGLE_CLOUD_PROJECT="YOUR_PROJECT_ID"
gemini
```

#### Option 2: Gemini API Key

**Best for:** Developers who need specific model control.

```bash
# Get your key from https://aistudio.google.com/apikey
export GEMINI_API_KEY="YOUR_API_KEY"
gemini
```

#### Option 3: Vertex AI

**Best for:** Enterprise teams and production workloads.

```bash
# Get your key from Google Cloud Console
export GOOGLE_API_KEY="YOUR_API_KEY"
export GOOGLE_GENAI_USE_VERTEXAI=true
gemini
```

### Step 3: Clone this Repository

```bash
git clone https://github.com/RichardScottOZ/ralph-gemini.git
cd ralph-gemini
```

### Step 4: Set Up a New Project

```bash
# Copy the ralph-gemini setup to your project
./setup-ralph.sh my-project

# Or manually:
mkdir my-project
cd my-project
git init
cp /path/to/ralph-gemini/templates/* .
```

### Project Structure After Setup

```
my-project/
‚îú‚îÄ‚îÄ .git/                      # Git repo (required)
‚îú‚îÄ‚îÄ GEMINI.md                  # Project context for Gemini CLI
‚îú‚îÄ‚îÄ PROMPT.md                  # Ralph's instructions (generated by plan)
‚îú‚îÄ‚îÄ TODO.md                    # Task checklist (generated by plan)
‚îú‚îÄ‚îÄ clarify-session.md         # Requirements (from interview)
‚îî‚îÄ‚îÄ src/                       # Your code (created during execution)
```

---

## üîÑ The Workflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                           PHASE 1: CLARIFY                               ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   Command: gemini (interactive session)                                 ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   üìã 40-70 questions via interactive chat                                ‚îÇ
‚îÇ   ‚Üí Exhaustive requirements discovery                                    ‚îÇ
‚îÇ   ‚Üí Output: clarify-session.md                                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                            PHASE 2: PLAN                                 ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   Command: gemini (interactive session)                                 ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   üìù Convert requirements to actionable tasks                            ‚îÇ
‚îÇ   ‚Üí Create PROMPT.md (execution instructions + guardrails)               ‚îÇ
‚îÇ   ‚Üí Create TODO.md (prioritized task checklist)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                    ‚îÇ
                                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          PHASE 3: EXECUTE                                    ‚îÇ
‚îÇ                                                                              ‚îÇ
‚îÇ   Command: while :; do cat PROMPT.md | gemini -p "$(cat -)"; done          ‚îÇ
‚îÇ                                                                              ‚îÇ
‚îÇ   üîÅ Ralph loop until complete                                               ‚îÇ
‚îÇ   ‚Üí Pick task ‚Üí Complete ‚Üí Mark done ‚Üí Repeat                                ‚îÇ
‚îÇ   ‚Üí Output: Working software                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã Phase 1: Clarify

The clarify phase uses interactive questioning to gather **40-70 questions** covering all aspects of the project.

### Why This Matters

> _"The loop pressure overrides the natural tendency to stop asking after 3-5 questions."_

### Question Categories

| Category | Questions to Cover |
|----------|-------------------|
| **Core Requirements** | What must this do? What's MVP? What's out of scope? |
| **Users & Context** | Who uses this? What's their skill level? What constraints exist? |
| **Technical Choices** | Language? Framework? Database? Dependencies? |
| **Integration Points** | What systems does this connect to? What data flows in/out? |
| **Edge Cases** | What happens when things fail? Boundary conditions? |
| **Quality Attributes** | Performance requirements? Security considerations? |
| **Existing Patterns** | How do similar things work in this codebase? Conventions? |
| **Preferences** | Strong opinions on approach? Tradeoffs? |

### Running the Clarify Phase

```bash
# Start Gemini CLI in your project directory
cd my-project
gemini

# In the chat, start with the clarify template:
> I want to use the Ralph Wiggum technique to gather comprehensive requirements.
> Please ask me 40-70 detailed questions about my project, covering:
> - Core requirements and MVP
> - Users and context
> - Technical choices
> - Integration points
> - Edge cases
> - Quality attributes
> - Existing patterns
> - Preferences
>
> My project is: [DESCRIBE YOUR PROJECT]
>
> After we complete all questions, save the results to clarify-session.md

# Answer the questions thoroughly
# The conversation will be saved in your terminal history
```

### Output: `clarify-session.md`

```markdown
# Discovery: Task Management API

Started: 2024-01-10

## Questions Asked
1. What authentication method? ‚Üí JWT
2. What database? ‚Üí PostgreSQL
3. ...

## Answers Received
- Authentication: JWT with refresh tokens
- Database: PostgreSQL with Prisma ORM
- ...

## Emerging Requirements
- Must support 1000 concurrent users
- API must be RESTful with OpenAPI spec
- All endpoints require authentication except /health
- ...
```

---

## üìù Phase 2: Plan

Convert the clarify session into actionable instructions.

### Running the Plan Phase

```bash
# Start Gemini CLI
cd my-project
gemini

# Tell it to read clarify-session.md and generate execution files
> Please read clarify-session.md and create two files:
> 
> 1. PROMPT.md - Execution instructions with guardrails
> 2. TODO.md - Prioritized task checklist with HARD STOP checkpoints
>
> Make sure PROMPT.md includes:
> - Clear task descriptions
> - Step-by-step instructions
> - Guardrails to prevent common mistakes
> - Completion criteria
>
> Make sure TODO.md includes:
> - Prioritized tasks
> - HARD STOP checkpoints for verification
> - Clear completion criteria
```

### Generated Files

**PROMPT.md** ‚Äî Execution instructions with guardrails  
**TODO.md** ‚Äî Prioritized task checklist with HARD STOP checkpoints

---

## üöÄ Phase 3: Execute

Run the Ralph loop until complete.

### Basic Loop

```bash
# Simple bash loop
while :; do 
  cat PROMPT.md | gemini -p "$(cat -)"
done
```

### Enhanced Loop with Completion Detection

```bash
# Loop that exits when "DONE" is detected
while :; do 
  output=$(cat PROMPT.md | gemini -p "$(cat -)")
  echo "$output"
  if echo "$output" | grep -q "DONE"; then
    echo "Task completed!"
    break
  fi
done
```

### Loop with Max Iterations (Recommended)

```bash
# Safe loop with iteration limit
max_iterations=50
iteration=0

while [ $iteration -lt $max_iterations ]; do
  echo "Iteration $((iteration + 1))/$max_iterations"
  output=$(cat PROMPT.md | gemini -p "$(cat -)")
  echo "$output"
  
  if echo "$output" | grep -q "DONE"; then
    echo "Task completed at iteration $((iteration + 1))!"
    break
  fi
  
  iteration=$((iteration + 1))
  sleep 2  # Avoid rate limiting
done

if [ $iteration -eq $max_iterations ]; then
  echo "Reached max iterations without completion"
fi
```

### Using the Provided Script

```bash
# Use the provided ralph-execute.sh script
./ralph-execute.sh --max-iterations 30

# See all options
./ralph-execute.sh --help
```

### What Happens During Execution

```
Iteration 1: Gemini reads PROMPT.md ‚Üí Picks Task 1 ‚Üí Implements ‚Üí Commits
     ‚Üì
Iteration 2: Gemini reads PROMPT.md ‚Üí Sees Task 1 done ‚Üí Picks Task 2 ‚Üí Implements ‚Üí Commits
     ‚Üì
Iteration 3: ...
     ‚Üì
Iteration N: All tasks done ‚Üí Gemini outputs "DONE" ‚Üí Loop exits
```

Each iteration:
- Sees the same `PROMPT.md`
- But files have changed (previous work persists)
- Git history shows progress
- `TODO.md` reflects completed tasks

---

## üìÑ Templates

### Minimal PROMPT.md (Start Here)

```markdown
# PROMPT.md

Build [WHAT YOU'RE BUILDING].

Requirements:
- [Requirement 1]
- [Requirement 2]
- [Requirement 3]

Track progress in TODO.md. Commit after each completed item.

When all requirements are implemented and tests pass, output: DONE
```

### PROMPT.md with Guardrails

```markdown
# PROMPT.md

## Task
[Description of what to build]

## Requirements
Read clarify-session.md for full requirements.

## Instructions
1. Read TODO.md for current tasks
2. Pick highest priority incomplete task
3. Read any files before editing them
4. Implement the task
5. Run tests
6. If tests fail, fix before continuing
7. Mark complete in TODO.md
8. Commit with clear message
9. Repeat until all tasks done

## Signs (Guardrails)
- Always read before editing
- Never skip failing tests
- Don't refactor unrelated code
- Keep commits focused
- Update TODO.md immediately after completing tasks

## Completion
When TODO.md shows all tasks complete and tests pass, output: DONE
```

### TODO.md Template

```markdown
# TODO

## Critical (Must Have)
- [ ] Task 1
- [ ] Task 2
- [ ] **HARD STOP** - Verify core flow works end-to-end

## Important (Should Have)
- [ ] Task 3
- [ ] Task 4

## Nice to Have
- [ ] Task 5
- [ ] Task 6

---
## Completed
- [x] Example completed task
```

### GEMINI.md Template

```markdown
# Project Context for Gemini CLI

## Project Overview
[Brief description of your project]

## Tech Stack
- Language: [e.g., Python 3.11]
- Framework: [e.g., FastAPI]
- Database: [e.g., PostgreSQL]
- Testing: [e.g., pytest]

## Build & Test Commands
```bash
# Install dependencies
npm install

# Run tests
npm test

# Build
npm run build
```

## Coding Conventions
- [Convention 1]
- [Convention 2]
- [Convention 3]

## Important Context
- [Any important context Gemini should know]
```

---

## ‚ö° Quick Start

```bash
# 1. Set up a new project
./setup-ralph.sh my-awesome-project
cd my-awesome-project

# 2. Phase 1: Clarify - gather requirements
gemini
# > Follow the clarify template to gather 40-70 questions
# > Save results to clarify-session.md

# 3. Phase 2: Plan - convert requirements to execution files
gemini
# > Ask Gemini to read clarify-session.md
# > Generate PROMPT.md and TODO.md

# 4. Phase 3: Execute - run the autonomous loop
./ralph-execute.sh
# Or manually:
# while :; do 
#   output=$(cat PROMPT.md | gemini -p "$(cat -)")
#   echo "$output"
#   if echo "$output" | grep -q "DONE"; then break; fi
# done
```

---

## üîÑ Differences from ralph-kiro

This implementation adapts the original Ralph Wiggum workflow from Kiro CLI to Gemini CLI:

| Feature | Kiro CLI (Original) | Gemini CLI (This Repo) |
|---------|-------------------|---------------------|
| **Agent System** | `.kiro/agents/*.yaml` files | GEMINI.md context file |
| **Clarify Phase** | `kiro-cli chat --agent ralph-clarify` | Interactive `gemini` session with template |
| **Plan Phase** | `kiro-cli chat --agent ralph-plan` | Interactive `gemini` session with template |
| **Execute Phase** | `kiro-cli chat --mode script` | `gemini -p "$(cat -)"` with stdin |
| **Configuration** | YAML agent configs | GEMINI.md context file |
| **Loop Control** | Manual bash loop | Manual bash loop |
| **Completion Detection** | Plain text "DONE" with grep | Plain text "DONE" with grep |
| **Context Window** | Kiro's context | Gemini 2.5 Pro 1M tokens |
| **Built-in Tools** | MCP servers | Google Search, shell, file ops |

### Key Adaptations

1. **GEMINI.md instead of Agents**: Gemini CLI uses a `GEMINI.md` file for project context instead of agent YAML files
2. **Interactive Phases 1 & 2**: Clarify and Plan phases use interactive Gemini sessions with templates
3. **Non-interactive Execution**: Phase 3 uses `gemini -p` with stdin piping for automation
4. **Built-in Tools**: Leverage Gemini's built-in Google Search grounding and shell commands
5. **Simpler Setup**: No agent configuration needed, just GEMINI.md context

---

## üõ†Ô∏è Troubleshooting

### Loop Runs Forever

**Problem**: The loop doesn't detect completion

**Solutions**:
- Ensure PROMPT.md explicitly tells Gemini to output "DONE"
- Check that the completion string matches exactly
- Add a max iterations limit to your loop

### Gemini Doesn't Follow Instructions

**Problem**: Gemini skips tasks or doesn't follow PROMPT.md

**Solutions**:
- Add more specific guardrails to PROMPT.md
- Break down large tasks into smaller, clearer subtasks
- Review completed iterations and add "signs" for common failures
- Update GEMINI.md with important conventions

### Rate Limiting

**Problem**: Hit rate limits during execution

**Solutions**:
```bash
# Add delays between iterations
sleep 2

# Use a paid tier for higher limits
# Or spread execution across multiple days
```

### Authentication Issues

**Problem**: CLI asks for authentication repeatedly

**Solutions**:
```bash
# Re-authenticate
gemini
# Choose "Login with Google" and follow prompts

# Or set API key
export GEMINI_API_KEY="YOUR_API_KEY"
```

---

## üéì Philosophy Recap

Ralph Wiggum is about:

1. **Iteration**: Repeat until done, not turn-by-turn interaction
2. **Guardrails**: Add "signs" based on failures
3. **Autonomy**: Let the AI work without constant supervision
4. **Tuning**: Improve prompts, not blame tools
5. **Patience**: Trust in eventual consistency

### When to Use Ralph

‚úÖ **Good for:**
- Large refactoring projects
- Greenfield development with clear requirements
- Test-driven development loops
- Repetitive implementation tasks

‚ùå **Not ideal for:**
- Exploratory/research tasks
- Complex debugging of unknown issues
- Tasks requiring frequent human judgment
- High-stakes production changes without review

---

## üìö Sources

- **Original Ralph Wiggum Concept**: [Geoffrey Huntley's Blog](https://ghuntley.com/ralph/)
- **Original Gist**: [Ralph_Wiggum_Loops.md by Mburdo](https://gist.github.com/Mburdo/ce99c9b08601aaf771efaabf1260d4c0)
- **Ralph-Kiro (Original)**: [https://github.com/RichardScottOZ/ralph-kiro](https://github.com/RichardScottOZ/ralph-kiro)
- **Gemini CLI Documentation**: [https://geminicli.com/](https://geminicli.com/)
- **Gemini CLI GitHub**: [https://github.com/google-gemini/gemini-cli](https://github.com/google-gemini/gemini-cli)

---

## ü§ù Contributing

Improvements welcome! Please submit issues or pull requests.

## üìÑ License

MIT License - Based on the original Ralph Wiggum workflow by Geoffrey Huntley, adapted from ralph-kiro by RichardScottOZ
